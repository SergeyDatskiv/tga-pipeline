FROM ubuntu:latest
LABEL maintainer="Sergey Datskiv <sergey.datskiv@jetbrains.com>"
LABEL version="0.0.0"
LABEL description="Docker image similar to abdullin/tga-pipeline:benchmarks, however with some changes needed for my experimental setup. E.g. I also compile test classes of the benchmark classes."


# install required packages
USER root
RUN apt-get -y update
RUN apt-get -y install \
	openjdk-11-jdk \
	maven \
	gradle \
	python3 \
	git

# clone gitbug repo
RUN git clone https://github.com/gitbugactions/gitbug-java.git /root/gitbug-java

# add scripts to container
ADD ./scripts /var/scripts

# run scripts and build benchmarks
RUN python3 /var/scripts/gitbug_setup.py /root/gitbug-java /var/benchmarks/gitbug False
RUN python3 /var/scripts/gitbug_setup.py /root/gitbug-java /var/benchmarks/gitbug-patched True

# give access to all users
RUN chmod a+wr -R /var/benchmarks